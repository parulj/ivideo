<html>
<head>
  <title>Interactive Video Ad</title>
  <script src="js/jquery-1.9.1.min.js"></script>
  <script>
    var VPAIDCreative;
 	var environmentVars = new Object();
	var videoContentUrl;
	var videoCurrentTime = 0;
	var adrunning = false;
	
	function startProcess() {
		markVideoContent();
	    initTheAd();
		startTheAd();
	}
	
	function loadTheAd() {
		//$("#playpause").click();
		var evt = document.createEvent("HTMLEvents");
		evt.initEvent("click", true, true); 
		document.getElementById("playpause").dispatchEvent(evt);
		
		//get the ad code vast xml from ad server and extract the js file from MediaFile element
		var ad_js_file = "myad.js";
		
		//create an IFrame and add a div inside for the overlay for interaction
		iframe = document.createElement('iframe'); 
		iframe.id = "adloaderframe"; 
		myAdDiv = document.getElementById('overlayDiv');
		myAdDiv.appendChild(iframe);

		iframe.contentWindow.document.write('<script src="' + ad_js_file + '"></scr' + 'ipt>'); 
		iframe.contentWindow.document.write ('<div id="videoAdLayer" style="width: 850; height:480;">');

		//Add a listener to resume the video ad when Ad has ended
		var videoSlot = document.getElementById('videoElement');	
		videoSlot.addEventListener('ended', function () {
		        if(adrunning) {
		        	videoSlot.removeEventListener('ended');
		        	resumeVideoContent();
		            adrunning=false;
				}
		    }, false);

			videoSlot.addEventListener('play', function () {
					var PlayPauseButton = document.getElementById('playpause');
					PlayPauseButton.value = "Pause";
			    }, false);

				videoSlot.addEventListener('pause', function () {
						var PlayPauseButton = document.getElementById('playpause');
						PlayPauseButton.value = "Play";
				    }, false);
		
		//add style to the iframe
		iframe = document.getElementById('adloaderframe');
		iframe.style.height = '480px';
		iframe.style.width = '850px';
		iframe.style.border = 'none';
		
		//iframe.style.overflow-y = 'hidden';
		//iframe.style.overflow-x = 'hidden';
		
		//VPAIDCreative = getVPAIDAd();
	}
	
	function initTheAd() {
		iframe = document.getElementById('adloaderframe');
		var fn = iframe.contentWindow['getVPAIDAd']; 
		
		if (fn && typeof fn == 'function') {
			VPAIDCreative = fn(); 
		}
		
		var slot = iframe.contentDocument.getElementById('videoAdLayer');
		environmentVars.slot = slot; 
		environmentVars.videoSlot = document.getElementById('videoElement'); 
		environmentVars.videoSlotCanAutoPlay = true;
		
		VPAIDCreative.initAd(slot.style.width, slot.style.height, "normal", null, null, 
		environmentVars);
	}
	
	function startTheAd() {
		adrunning = true;
		VPAIDCreative.startAd();
	}
	
	function playVideoContent() {
		videoSlot = document.getElementById('videoElement');
		videoSlot.play();
	}
	
	function markVideoContent() {
		videoSlot = document.getElementById('videoElement');
		videoSlot.pause();
		videoContentUrl = videoSlot.src;
		videoCurrentTime = videoSlot.currentTime;
	}

	function resumeVideoContent() {
		iframe = document.getElementById('adloaderframe');
		adDiv = iframe.contentDocument.getElementById('videoAdLayer');
		adDiv.parentNode.removeChild(adDiv);
		
		videoSlot = document.getElementById('videoElement');
		videoSlot.src = videoContentUrl;
		
		videoSlot.addEventListener('loadeddata', function() {
			    if(adrunning) {
					videoSlot.currentTime = 0;
				} else {
					videoSlot.currentTime = videoCurrentTime;
				}
				videoSlot.play();
			});
			
		videoSlot.load();
		//alert(videoCurrentTime + ' ' + videoContentUrl);
	}
	
	/*function togglePlay() {
		var togglePlayButton = document.getElementById('togglePlay');
		var videoSlot = document.getElementById('videoElement');
		if(togglePlayButton.value == "PlayVideoContent") {
			togglePlayButton.value = "PauseVideoContent";
			videoSlot.addEventListener('ended', function () {
			        if(adrunning) {
			        	videoSlot.removeEventListener('ended');
			        	resumeVideoContent();
			            adrunning=false;
					}
			    }, false);
			
			videoSlot.play();
		} else {
			togglePlayButton.value = "PlayVideo";
			videoSlot.pause();			
		}
	}*/
	function toggleVideoContentPlay() {
		var videoSlot = document.getElementById('videoElement');
		//var PlayPauseButton = document.getElementById('playpause');
		if(videoSlot.paused) {
			//PlayPauseButton.value = "Pause";
			videoSlot.play();
		} else {
			//PlayPauseButton.value = "Play";
			videoSlot.pause();
		}
	}
  </script>
  <style type="text/css">
    body {
      margin:0;
    }

    #playerDiv {
      width:850px;
      height:490px;
    }

    #playerDiv video {
    	height: 490px;
        width: 850px;
    }

    #overlayDiv {
      position: absolute;
      top:15px;
      width:850px;
      height:490px;
    }

    #mainContainer {
    	padding: 10px;
    }

  </style>
</head>
<body onLoad="loadTheAd()">
<div id="mainContainer">
<div id="playerDiv"><video id="videoElement" src="big_buck_bunny.mp4"></video></div>
<div id="overlayDiv"></div>
</div>
<!--<input type="hidden" id = "togglePlay" value="PlayVideoContent" onclick="javascript:togglePlay()">-->
<input type="button" id="playpause" value="Play" onclick="javascript:toggleVideoContentPlay()" style="margin-left:350">
<input type="button" value="StartAd" onclick="javascript:startProcess();" >

</body>
</html>